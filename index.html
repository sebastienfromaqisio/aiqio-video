<!doctype html>
<html lang="fr">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>VidÃ©o</title>

Â  Â  Â  <link rel="dns-prefetch" href="https://iframe.cloudflarestream.com">
Â  <link rel="preconnect" href="https://iframe.cloudflarestream.com" crossorigin>
Â  <link rel="dns-prefetch" href="https://embed.cloudflarestream.com">
Â  <link rel="preconnect" href="https://embed.cloudflarestream.com" crossorigin>

Â  Â  <link rel="dns-prefetch" href="https://assets.calendly.com">
Â  <link rel="preconnect" href="https://assets.calendly.com" crossorigin>
Â  <link rel="dns-prefetch" href="https://calendly.com">
Â  <link rel="preconnect" href="https://calendly.com" crossorigin>
Â  <link rel="preload" as="script" href="https://assets.calendly.com/assets/external/widget.js">

Â  <style>
Â  Â  :root { --gap: clamp(12px, 3vw, 32px); }
Â  Â  html, body { margin:0; height:100%; background:#000; overflow:hidden; }

Â  Â  /* scÃ¨ne centrÃ©e avec marge respirante */
Â  Â  .stage { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; padding: var(--gap); box-sizing: border-box; background:#000; }
Â  Â  .frame { width: clamp(320px, 88vw, 1100px); aspect-ratio: 16 / 9; max-height: 68vh; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,.35); background:#000; }
Â  Â  @media (max-width: 640px) { .frame { width: 96vw; max-height: 58vh; } }
Â  Â  #player { width: 100%; height: 100%; border: 0; object-fit: cover; background:#000; }

Â  Â  /* CTA */
Â  Â  .cta {
Â  Â  Â  position: fixed; right: var(--gap); bottom: var(--gap); z-index: 30;
Â  Â  Â  background:#006BFF; color:#fff; border:0; border-radius:16px;
Â  Â  Â  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
Â  Â  Â  font-weight: 700; letter-spacing:.2px; padding: 14px 16px; font-size: 14px; line-height: 1.1;
Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,.35); cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent;
Â  Â  }
Â  Â  .cta:active { transform: translateY(1px); }
Â  Â  @media (min-width: 1024px) { .cta { padding: 22px 26px; font-size: 18px; border-radius:20px; } }

Â  Â  /* Modal Calendly (prÃ©-initialisÃ© mais cachÃ© â†’ prÃªt instantanÃ©ment au clic/fin vidÃ©o) */
Â  Â  .modal { position:fixed; inset:0; z-index:50; display:none; background:rgba(0,0,0,.65); backdrop-filter:blur(2px); }
Â  Â  .modal__panel { position:absolute; inset: var(--gap); background:#fff; border-radius:16px; overflow:hidden; display:flex; flex-direction:column; box-shadow: 0 20px 60px rgba(0,0,0,.45); }
Â  Â  .modal__head { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0b1220; color:#fff; font:600 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
Â  Â  .modal__close { appearance:none; border:0; background:transparent; color:#fff; cursor:pointer; font-size:18px; padding:6px; line-height:1; }
Â  Â  .modal__body { flex:1; min-height:420px; background:#fff; }
Â  Â  .calendly-inline-widget { width:100%; height:100%; min-width:320px; }
Â  </style>

Â  Â  <script src="https://embed.cloudflarestream.com/embed/sdk.latest.js?v=3" defer></script>
Â  Â  <script src="https://assets.calendly.com/assets/external/widget.js" async></script>
</head>
<body>
Â  Â  <div class="stage">
Â  Â  <div class="frame">
Â  Â  Â  <iframe id="player" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen loading="eager"></iframe>
Â  Â  </div>
Â  </div>

Â  Â  <button id="cta" class="cta">ðŸ“ž RÃ©servez un Rendez-Vous !</button>

Â  Â  <div id="cal-modal" class="modal" aria-hidden="true">
Â  Â  <div class="modal__panel" role="dialog" aria-modal="true" aria-label="RÃ©server un rendez-vous">
Â  Â  Â  <div class="modal__head">
Â  Â  Â  Â  <span id="modal-title">RÃ©server un rendez-vous</span>
Â  Â  Â  Â  <button class="modal__close" id="cal-close" aria-label="Fermer">âœ•</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="modal__body">
Â  Â  Â  Â  <div class="calendly-inline-widget"
Â  Â  Â  Â  Â  Â  Â data-url="https://calendly.com/aqisio/presentation?hide_event_type_details=1&hide_gdpr_banner=1">
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  (function () {
Â  Â  Â  "use strict";

Â  Â  Â  /* ============================
Â  Â  Â  Â * 1) PARAMS & PERSONNALISATION
Â  Â  Â  Â * ============================ */
Â  Â  Â  const qp = new URLSearchParams(location.search);
Â  Â  Â  const fÂ  = (qp.get("f")Â  || "").trim();
Â  Â  Â  const lÂ  = (qp.get("l")Â  || "").trim();
Â  Â  Â  const id = (qp.get("id") || "").trim();
Â  Â  Â  const dÂ  = (qp.get("d")Â  || "").trim();
Â  Â  Â  if (!/^[a-f0-9]{32}$/i.test(id)) { console.error("Stream ID invalide"); return; }

Â  Â  Â  const prettyF = f || "Vous";
Â  Â  Â  document.title = `${prettyF}, regardez la vidÃ©o !`;
Â  Â  Â  const cta = document.getElementById("cta");
Â  Â  Â  cta.textContent = `ðŸ“ž ${prettyF}, RÃ©servez un Rendez-Vous !`;

Â  Â  Â  /* ============================
Â  Â  Â  Â * 2) SESSION & PLAYER (ModifiÃ© avec Poster)
Â  Â  Â  Â * ============================ */
Â  Â  Â  const sessionId = (self.crypto && crypto.randomUUID)
Â  Â  Â  Â  ? `sid_${id.slice(0,8)}_${crypto.randomUUID().slice(0,8)}`
Â  Â  Â  Â  : `sid_${id.slice(0,8)}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`;

Â  Â  Â  const iframe = document.getElementById("player");

Â  Â  Â  // 1. Remplacez par votre sous-domaine/hash client Cloudflare Stream
Â  Â  Â  const CUSTOMER_HASH = "customer-f33zs165nr7gyfy4.cloudflarestream.com"; // <-- VÃ‰RIFIEZ CECI

Â  Â  Â  // 2. Construisez l'URL de la thumbnail animÃ©e (GIF)
      //    (Ajustez les paramÃ¨tres 'height', 'duration', 'time' ici)
Â  Â  Â  const posterUrl = `https://${CUSTOMER_HASH}/${id}/thumbnails/thumbnail.gif?time=1s&height=720&duration=4s&fps=12`;

Â  Â  Â  // 3. Encodez cette URL pour la passer en paramÃ¨tre
Â  Â  Â  const encodedPosterUrl = encodeURIComponent(posterUrl);

Â  D Â  Â  // 4. Mettez Ã  jour l'URL de l'iframe pour inclure le "poster" et les "sous-titres"
Â  Â  Â  iframe.src = `https://iframe.cloudflarestream.com/${id}?v=3&defaultTextTrack=fr&poster=${encodedPosterUrl}`;


Â  Â  Â  /* ============================
Â  Â  Â  Â * 3) TRACKING helper (non bloquant)
Â  Â  Â  Â * ============================ */
Â  Â  Â  const WEB_APP = "https://script.google.com/macros/s/AKfycbyFxJ2lUMtuB44kud-xGFcMGudW2J5G2UWMD2QtjvolJiUpRtA4zeX9e4_KieRIlzaF-g/exec";
Â  Â  Â  function ping(ev, extra) {
Â  Â  Â  Â  const base = { ev, f, l, id, d, sessionId, ua:navigator.userAgent, ref:document.referrer||"", w:String(innerWidth||0), h:String(innerHeight||0), ts:String(Date.now()) };
Â  Â  Â  Â  const payload = new URLSearchParams(Object.assign(base, extra||{}));
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  if (navigator.sendBeacon) {
Â  Â  Â  Â  Â  Â  const blob = new Blob([payload.toString()], { type:"application/x-www-form-urlencoded" });
Â  Â  Â  Â  Â  Â  navigator.sendBeacon(WEB_APP, blob); return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch(_) {}
Â  Â  Â  Â  fetch(WEB_APP + "?" + payload.toString(), { method:"GET", mode:"no-cors", keepalive:true }).catch(()=>{});
Â  Â  Â  }
Â  Â  Â  (function openedOnce(){
Â  Â  Â  Â  const key = `aqi_opened_${id}_${d||"nodate"}`;
Â  Â  Â  Â  const first = !localStorage.getItem(key);
Â  Â  Â  Â  try { localStorage.setItem(key,"1"); } catch(e){}
Â  Â  Â  Â  ping("opened", { first: first ? "1" : "0", cur:"0", dur:"0" });
Â  Â  Â  })();

Â  Â  Â  /* ============================
Â  Â  Â  Â * 4) CALENDLY MODAL (prÃ©-initialisÃ©, rÃ©ouvrable)
Â  Â  Â  Â * ============================ */
Â  Â  Â  const modal = document.getElementById("cal-modal");
Â  Â  Â  const closeBtn = document.getElementById("cal-close");
Â  Â  Â  function showCalendly(){ modal.style.display="block"; modal.setAttribute("aria-hidden","false"); ping("calendly_open"); }
Â  Â  Â  function hideCalendly(){ modal.style.display="none"; modal.setAttribute("aria-hidden","true"); }
Â  Â  Â  cta.addEventListener("click", ()=>{ ping("cta_click"); showCalendly(); });
Â  Â  Â  closeBtn.addEventListener("click", hideCalendly);
Â  Â  Â  modal.addEventListener("click", (e)=>{ if(e.target === modal) hideCalendly(); });
Â  Â  Â  addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideCalendly(); });

Â  Â  Â  /* ============================
Â  Â  Â  Â * 5) PLAYER + TRACKING 1s
Â  Â  Â  Â * ============================ */
Â  Â  Â  function onReady(cb){ (document.readyState === "complete" ? cb : addEventListener("load", cb)); }
Â  Â  Â  onReady(function(){
Â  Â  Â  Â  if (typeof Stream !== "function") { console.error("SDK Stream indisponible"); return; }
Â  Â  Â  Â  const player = Stream(iframe);

Â  Â  Â  Â  // --- Tracking Ã  la seconde (client-side) ---
Â  Â  Â  Â  let duration = 0, launched = false;
Â  Â  Â  Â  const sentSeconds = new Set();
Â  Â  Â  Â  let tick = null;
Â  Â  Â  Â  const getTimes = () => {
Â  Â  Â  Â  Â  const ct = Math.max(0, Math.floor(Number(player.currentTime || 0)));
Â  Â  Â  Â  Â  const du = Math.max(0, Math.floor(Number(player.durationÂ  Â || duration || 0)));
Â  Â  Â  Â  Â  if (!duration && du) duration = du;
Â  Â  Â  Â  Â  return { cur:String(ct), dur:String(du) };
Â  Â  Â  Â  };
Â  Â  Â  Â  function startTick(){ if (!tick) tick = setInterval(()=>{ const t=getTimes(); const s=+t.cur; if(!sentSeconds.has(s)){ sentSeconds.add(s); ping("sec",t);} },1000); }
	  function stopTick(){ if (tick){ clearInterval(tick); tick=null; } }

Â  Â  Â  Â  player.addEventListener("durationchange", ()=>{ const du=Math.floor(Number(player.duration||0)); if(du>0) duration=du; });
Â  Â  Â  Â  player.addEventListener("playing", ()=>{ if(!launched){ launched=true; ping("launched", getTimes()); } startTick(); });
Â  Â  Â  Â  player.addEventListener("pause",Â  Â ()=>{ ping("pause", getTimes()); stopTick(); });
Â  Â  Â  Â  player.addEventListener("ended",Â  Â ()=>{ const t=getTimes(); const s=+t.cur; if(!sentSeconds.has(s)){ sentSeconds.add(s); ping("sec",t);} ping("completed", t); stopTick(); showCalendly(); });

Â  Â  Â  Â  // Seek (optionnel)
Â  Â  Â  	let from=0; player.addEventListener("seeking", ()=>{ from=+getTimes().cur; });
Â  Â  Â  	player.addEventListener("seeked",Â  ()=>{ const t=getTimes(); ping("seek", Object.assign({}, t, { from:String(from), to:t.cur })); });

Â  Â  Â  Â  // Sauvegarde dernier point si fermeture
Â  Â  Â  Â  addEventListener("visibilitychange", ()=>{ if (document.visibilityState==="hidden") ping("hidden", getTimes()); });
Â  Â  Â  	addEventListener("pagehide", ()=>{ ping("pagehide", getTimes()); });
Â  Â  Â  });
Â  Â  })();
Â  </script>
</body>
</html>
