<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vidéo de prospection Aqisio</title>

  <!-- Accélération Calendly -->
  <link rel="preconnect" href="https://assets.calendly.com" crossorigin>
  <link rel="preconnect" href="https://calendly.com" crossorigin>
  <link rel="preload" as="script" href="https://assets.calendly.com/assets/external/widget.js">

  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; background:#0b0b0b; color:#fff;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    }
    .wrap{ display:grid; place-items:center; min-height:100dvh; padding:24px; }
    .player{
      width:min(960px,100%);
      aspect-ratio:16/9;
      position:relative; /* pour positionner le CTA */
    }
    iframe{ width:100%; height:100%; border:0; border-radius:16px; }
    .note{ opacity:.7; margin-top:12px; font-size:.9rem; text-align:center; }

    /* === CTA sur la vidéo === */
    .cta-btn{
      position:absolute;
      top:12px; left:12px;            /* position desktop */
      z-index:5;                      /* au-dessus de l'iframe */
      background:#0156CC;             /* bleu demandé */
      color:#fff;
      border:0; border-radius:10px;
      padding:10px 14px;
      font-weight:600;
      font-size:14px;
      line-height:1;
      cursor:pointer;
      box-shadow:0 6px 20px rgba(1,86,204,.35);
      transition:transform .12s ease, opacity .12s ease, box-shadow .12s ease;
    }
    .cta-btn:hover{ transform:translateY(-1px); box-shadow:0 8px 26px rgba(1,86,204,.45); }
    .cta-btn:active{ transform:translateY(0); opacity:.95; }

    /* Position mobile : bas-droite, plus “thumb-friendly” */
    @media (max-width: 768px){
      .cta-btn{
        top:auto; left:auto;
        right:12px; bottom:12px;     /* bas-droite */
        padding:12px 16px;
        font-size:15px;
        border-radius:12px;
      }
    }

    /* === Modal Calendly (préchargé, invisible au départ) === */
    .overlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,.6);
      display: grid; place-items: center;
      z-index: 9999;
      transition: opacity .18s ease, visibility .18s ease;
    }
    .overlay.hidden{ opacity:0; visibility:hidden; pointer-events:none; }
    .modal{
      width:min(980px,96vw); height:min(760px,88vh);
      background:#101012; border:1px solid rgba(255,255,255,.08);
      border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.45);
      overflow:hidden; transform:translateY(6px);
      transition: transform .18s ease, opacity .18s ease; opacity:1;
    }
    .overlay.hidden .modal{ transform:translateY(12px); opacity:0; }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; background:#0c0c0f; border-bottom:1px solid rgba(255,255,255,.06);
    }
    .modal-title{ margin:0; font-size:.95rem; opacity:.9; }
    .close-btn{
      border:0; background:#1a1a1f; color:#fff; border-radius:8px;
      padding:6px 10px; cursor:pointer; opacity:.9;
    }
    .calendly-host{ width:100%; height: calc(100% - 46px); }
    .calendly-inline-widget{ width:100%; height:100%; }
  </style>

  <!-- Script Calendly chargé d’emblée (pour affichage instantané) -->
  <script src="https://assets.calendly.com/assets/external/widget.js" async></script>
</head>
<body>
  <div class="wrap">
    <div class="player">
      <!-- CTA au-dessus de la vidéo -->
      <button id="ctaBtn" class="cta-btn" aria-label="Prendre rendez-vous">Prendre RDV</button>

      <!-- Cloudflare Stream : ta vidéo -->
      <iframe id="stream-player"
        src="https://customer-g50chvgfq5q94nqo.cloudflarestream.com/5032da31754eb596edf1e9d68cbe031e/iframe?autoplay=true&muted=true"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen="true"></iframe>
    </div>

    <!-- Compteur / debug (tu peux supprimer si tu veux) -->
    <p class="note" id="debug"></p>
  </div>

  <!-- Modal Calendly (pré-monté pour précharger l'iframe) -->
  <div id="calOverlay" class="overlay hidden" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="calTitle">
      <div class="modal-head">
        <h2 id="calTitle" class="modal-title">Réserve un créneau avec Aqisio</h2>
        <button id="calClose" class="close-btn">Fermer</button>
      </div>
      <div class="calendly-host">
        <div class="calendly-inline-widget"
             data-url="https://calendly.com/aqisio/presentation?hide_event_type_details=1&hide_gdpr_banner=1">
        </div>
      </div>
    </div>
  </div>

  <!-- SDK Cloudflare Stream -->
  <script src="https://embed.cloudflarestream.com/embed/sdk.latest.js"></script>

  <script>
    // ——— Player (autoplay robuste)
    const player = Stream(document.getElementById("stream-player"));
    player.play().catch(async () => { try { player.muted = true; await player.play(); } catch(_) {} });

    // ——— Popup Calendly (ouverte soit par CTA, soit à la fin de la vidéo si tu veux)
    const calOverlay = document.getElementById('calOverlay');
    const calClose   = document.getElementById('calClose');
    const ctaBtn     = document.getElementById('ctaBtn');

    function openCalendly(){
      calOverlay.classList.remove('hidden');
      calOverlay.setAttribute('aria-hidden', 'false');
    }
    function closeCalendly(){
      calOverlay.classList.add('hidden');
      calOverlay.setAttribute('aria-hidden', 'true');
    }
    calClose.addEventListener('click', closeCalendly);
    ctaBtn.addEventListener('click', openCalendly);

    // (Optionnel) ouvrir aussi à la fin de la vidéo :
    // player.addEventListener('ended', openCalendly);

    // Accessibilité : fermer sur Echap
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeCalendly(); });

    // ——— Debug si besoin
    const debug = document.getElementById('debug');
    function setNote(t){ if(debug) debug.textContent=t; }
  </script>
</body>
</html>
